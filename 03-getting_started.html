<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue.js双向绑定的实现原理 | javascript 学习总结</title>
    <meta name="description" content="持续更新中...">
    
    
    <link rel="preload" href="/assets/css/0.styles.bc72b5c6.css" as="style"><link rel="preload" href="/assets/js/app.fa27fcb7.js" as="script"><link rel="preload" href="/assets/js/8.5ea0397d.js" as="script"><link rel="prefetch" href="/assets/js/10.50f8cc69.js"><link rel="prefetch" href="/assets/js/11.63165319.js"><link rel="prefetch" href="/assets/js/12.c77fd109.js"><link rel="prefetch" href="/assets/js/13.d3bcb504.js"><link rel="prefetch" href="/assets/js/14.2ab5316d.js"><link rel="prefetch" href="/assets/js/15.50e05516.js"><link rel="prefetch" href="/assets/js/16.cc4e9e6b.js"><link rel="prefetch" href="/assets/js/17.cf8a5144.js"><link rel="prefetch" href="/assets/js/18.995ea2c3.js"><link rel="prefetch" href="/assets/js/19.b53dbd1f.js"><link rel="prefetch" href="/assets/js/2.24befd02.js"><link rel="prefetch" href="/assets/js/20.4f10ac6f.js"><link rel="prefetch" href="/assets/js/21.a93f4746.js"><link rel="prefetch" href="/assets/js/3.c69e2e19.js"><link rel="prefetch" href="/assets/js/4.da806239.js"><link rel="prefetch" href="/assets/js/5.953b51b4.js"><link rel="prefetch" href="/assets/js/6.f74ce3b5.js"><link rel="prefetch" href="/assets/js/7.ebbd53f9.js"><link rel="prefetch" href="/assets/js/9.396e3ff8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc72b5c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">javascript 学习总结</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://liuyang.feblog.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  刘洋博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuejs.feblog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://nodejs.feblog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  nodejs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/thisliuyang/javascript-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://liuyang.feblog.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  刘洋博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">学习文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://vuejs.feblog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://nodejs.feblog.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  nodejs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/thisliuyang/javascript-tutorial" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/00-javascript.html" class="sidebar-link">Javascript基础</a></li><li><a href="/01-web_concept.html" class="sidebar-link">Javascript 的 this 用法</a></li><li><a href="/02-node_introduction.html" class="sidebar-link">JS 中可以提升幸福度的小技巧</a></li><li><a href="/03-getting_started.html" class="active sidebar-link">Vue.js双向绑定的实现原理</a></li><li><a href="/04-module.html" class="sidebar-link">常用 Git 命令清单</a></li><li><a href="/05-package_npm.html" class="sidebar-link">浏览器同源政策及其规避方法</a></li><li><a href="/06-fs.html" class="sidebar-link">深入理解函数作用域之形参作用域</a></li><li><a href="/07-web.html" class="sidebar-link">数组的几个不 low 操作</a></li><li><a href="/08-express.html" class="sidebar-link">选择排序、桶排序、冒泡排序和快速排序</a></li><li><a href="/09-db.html" class="sidebar-link">window 对象</a></li><li><a href="/10-web_db.html" class="sidebar-link">XMLHttpRequest 对象</a></li><li><a href="/11-session_persistence.html" class="sidebar-link">Promise 对象</a></li><li><a href="/12-ajax.html" class="sidebar-link">Document 节点</a></li><li><a href="/13-alibaixiu.html" class="sidebar-link">Element 节点</a></li><li><a href="/14-asynchronous_ programming.html" class="sidebar-link">异步操作概述</a></li><li><a href="/15-dep_ops.html" class="sidebar-link">鼠标事件</a></li><li><a href="/16-other.html" class="sidebar-link">js常用函数</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue-js双向绑定的实现原理"><a href="#vue-js双向绑定的实现原理" aria-hidden="true" class="header-anchor">#</a> <a href="https://www.cnblogs.com/kidney/p/6052935.html" target="_blank" rel="noopener noreferrer">Vue.js双向绑定的实现原理<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h1> <p>​       Vue.js 最核心的功能有两个，一是响应式的数据绑定系统，二是组件系统。本文仅探究双向绑定是怎样实现的。先讲涉及的知识点，再用简化得不能再简化的代码实现一个简单的 hello world 示例。</p> <p>参考文章：<a href="https://segmentfault.com/a/1190000006599500" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000006599500<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>一、访问器属性</strong></p> <p>​       访问器属性是对象中的一种特殊属性，它不能直接在对象中设置，而必须通过 defineProperty() 方法单独定义。</p> <p>​       var obj = { };</p> <p>​       // 为obj定义一个名为 hello 的访问器属性</p> <p>​       Object.defineProperty(obj, &quot;hello&quot;, {</p> <p>​         get: function () {return sth},</p> <p>​         set: function (val) {/* do sth */}</p> <p>​       })</p> <p>​       obj.hello // 可以像普通属性一样读取访问器属性</p> <p>​       访问器属性的&quot;值&quot;比较特殊，读取或设置访问器属性的值，实际上是调用其内部特性：get和set函数。</p> <p>​       obj.hello // 读取属性，就是调用get函数并返回get函数的返回值</p> <p>​       obj.hello = &quot;abc&quot; // 为属性赋值，就是调用set函数，赋值其实是传参 <img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120155820248-500778578.png" alt="img"></p> <p>​       get 和 set 方法内部的 this 都指向 obj，这意味着 get 和 set 函数可以操作对象内部的值。另外，访问器属性的会&quot;覆盖&quot;同名的普通属性，因为访问器属性会被优先访问，与其同名的普通属性则会被忽略。</p> <p><strong>二、极简双向绑定的实现</strong></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120155856263-1051312268.png" alt="img"></p> <p>​       此例实现的效果是：随文本框输入文字的变化，span 中会同步显示相同的文字内容；在js或控制台显式的修改 obj.hello 的值，视图会相应更新。这样就实现了 model =&gt; view 以及 view =&gt; model 的双向绑定。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160007029-1444374091.png" alt="img"></p> <p>​       以上就是 Vue 实现双向绑定的基本原理。</p> <p><strong>三、分解任务</strong></p> <p>​       上述示例仅仅是为了说明原理。我们最终要实现的是：</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160023154-705049955.png" alt="img"></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160046920-469941328.png" alt="img"></p> <p>​       首先将该任务分成几个子任务：</p> <p>1、输入框以及文本节点与 data 中的数据绑定</p> <p>2、输入框内容变化时，data 中的数据同步变化。即 view =&gt; model 的变化。</p> <p>3、data 中的数据变化时，文本节点的内容同步变化。即 model =&gt; view 的变化。</p> <p>​       要实现任务一，需要对 DOM 进行编译，这里有一个知识点：DocumentFragment。</p> <p><strong>四、DocumentFragment</strong></p> <p>​       DocumentFragment（文档片段）可以看作节点容器，它可以包含多个子节点，当我们将它插入到 DOM 中时，只有它的子节点会插入目标节点，所以把它看作一组节点的容器。使用 DocumentFragment 处理节点，速度和性能远远优于直接操作 DOM。Vue 进行编译时，就是将挂载目标的所有子节点劫持（真的是劫持，通过 append 方法，DOM 中的节点会被自动删除）到 DocumentFragment 中，经过一番处理后，再将 DocumentFragment 整体返回插入挂载目标。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160124217-527060528.png" alt="img"></p> <p># 勘误：flag.append() 应为 flag.appendChild()。下同。在 Chrome 中用 append() 竟然正常，没报错。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160134232-1887803443.png" alt="img"></p> <p>​</p> <p><strong>五、数据初始化绑定</strong></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160200217-164611845.png" alt="img"></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160233873-127171744.png" alt="img"></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160243545-44236467.png" alt="img"></p> <p>​       以上代码实现了任务一，我们可以看到，hello world已经呈现在输入框和文本节点中。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160327467-1883154446.png" alt="img"></p> <p><strong>六、响应式的数据绑定</strong></p> <p>​       再来看任务二的实现思路：当我们在输入框输入数据的时候，首先触发 input 事件（或者 keyup、change 事件），在相应的事件处理程序中，我们获取输入框的 value 并赋值给 vm 实例的 text 属性。我们会利用 defineProperty 将 data 中的 text 设置为 vm 的访问器属性，因此给 vm.text 赋值，就会触发 set 方法。在 set 方法中主要做两件事，第一是更新属性的值，第二留到任务三再说。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160409513-886321336.png" alt="img"></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160441326-1073521186.png" alt="img"></p> <p>​       任务二也就完成了，text 属性值会与输入框的内容同步变化：</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160501763-1127106704.png" alt="img"></p> <p><strong>七、订阅/发布模式（subscribe&amp;publish）</strong></p> <p>​       text 属性变化了，set 方法触发了，但是文本节点的内容没有变化。如何让同样绑定到 text 的文本节点也同步变化呢？这里又有一个知识点：订阅发布模式。</p> <p>​       订阅发布模式（又称观察者模式）定义了一种一对多的关系，让多个观察者同时监听某一个主题对象，这个主题对象的状态发生改变时就会通知所有观察者对象。</p> <p>​       发布者发出通知 =&gt; 主题对象收到通知并推送给订阅者 =&gt; 订阅者执行相应操作</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160541513-1856723431.png" alt="img"></p> <p>​       之前提到的，当 set 方法触发后做的第二件事就是作为发布者发出通知：“我是属性 text，我变了”。文本节点则是作为订阅者，在收到消息后执行相应的更新操作。</p> <p><strong>八、双向绑定的实现</strong></p> <p>​       回顾一下，每当 new 一个 Vue，主要做了两件事：第一个是监听数据：observe(data)，第二个是编译 HTML：nodeToFragement(id)。</p> <p>​       在监听数据的过程中，会为 data 中的每一个属性生成一个主题对象 dep。</p> <p>​       在编译 HTML 的过程中，会为每个与数据绑定相关的节点生成一个订阅者 watcher，watcher 会将自己添加到相应属性的 dep 中。</p> <p>​       我们已经实现：修改输入框内容 =&gt; 在事件回调函数中修改属性值 =&gt; 触发属性的 set 方法。</p> <p>​       接下来我们要实现的是：发出通知 dep.notify() =&gt; 触发订阅者的 update 方法 =&gt; 更新视图。</p> <p>​       这里的关键逻辑是：如何将 watcher 添加到关联属性的 dep 中。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160644154-1888733590.png" alt="img"></p> <p>​       在编译 HTML 过程中，为每个与 data 关联的节点生成一个 Watcher。Watcher 函数中发生了什么呢？</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160659310-1972832043.png" alt="img"></p> <p>​       首先，将自己赋给了一个全局变量 Dep.target；</p> <p>​       其次，执行了 update 方法，进而执行了 get 方法，get 的方法读取了 vm 的访问器属性，从而触发了访问器属性的 get 方法，get 方法中将该 watcher 添加到了对应访问器属性的 dep 中；</p> <p>​       再次，获取属性的值，然后更新视图。</p> <p>​       最后，将 Dep.target 设为空。因为它是全局变量，也是 watcher 与 dep 关联的唯一桥梁，任何时刻都必须保证 Dep.target 只有一个值。</p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160749388-947918217.png" alt="img"></p> <p><img src="https://images2015.cnblogs.com/blog/925891/201611/925891-20161120160814420-1825354650.png" alt="img"></p> <p>​       至此，hello world 双向绑定就基本实现了。文本内容会随输入框内容同步变化，在控制器中修改 vm.text 的值，会同步反映到文本内容中。</p> <p></p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/thisliuyang/javascript-tutorial/edit/master/docs/03-getting_started.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/15/2019, 1:31:32 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/02-node_introduction.html" class="prev">
          JS 中可以提升幸福度的小技巧
        </a></span> <span class="next"><a href="/04-module.html">
          常用 Git 命令清单
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.fa27fcb7.js" defer></script><script src="/assets/js/8.5ea0397d.js" defer></script>
  </body>
</html>
