(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{184:function(t,e,s){"use strict";s.r(e);var a=s(0),i=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("1995年，同源政策由 Netscape 公司引入浏览器。目前，所有浏览器都实行这个政策。")]),t._v(" "),s("p",[t._v('最初，它的含义是指，A网页设置的 Cookie，B网页不能打开，除非这两个网页"同源"。所谓"同源"指的是"三个相同"。')]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。")]),t._v(" "),s("p",[t._v("设想这样一种情况：A网站是一家银行，用户登录以后，又去浏览其他网站。如果其他网站可以读取A网站的 Cookie，会发生什么？")]),t._v(" "),s("p",[t._v("很显然，如果 Cookie 包含隐私（比如存款总额），这些信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。因为浏览器同时还规定，提交表单不受同源政策的限制。")]),t._v(" "),s("p",[t._v('由此可见，"同源政策"是必需的，否则 Cookie 可以共享，互联网就毫无安全可言了。')]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v('随着互联网的发展，"同源政策"越来越严格。目前，如果非同源，共有三种行为受到限制。')]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("虽然这些限制是必要的，但是有时很不方便，合理的用途也受到影响。下面，我将详细介绍，如何规避上面三种限制。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("现在，A网页通过脚本设置一个 Cookie。")]),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("B网页就可以读到这个 Cookie。")]),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("注意，这种方法只适用于 Cookie 和 iframe 窗口，LocalStorage 和 IndexDB 无法通过这种方法，规避同源政策，而要使用下文介绍的PostMessage API。")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),s("p",[t._v("这样的话，二级域名和三级域名不用做任何设置，都可以读取这个Cookie。")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),s("p",[t._v("上面命令中，父窗口想获取子窗口的DOM，因为跨源导致报错。")]),t._v(" "),s("p",[t._v("反之亦然，子窗口获取主窗口的DOM也会报错。")]),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),s("p",[t._v("对于完全不同源的网站，目前有三种方法，可以解决跨域窗口的通信问题。")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("父窗口可以把信息，写入子窗口的片段标识符。")]),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),s("p",[t._v("同样的，子窗口也可以改变父窗口的片段标识符。")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),s("p",[t._v("接着，子窗口跳回一个与主窗口同域的网址。")]),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),s("p",[t._v("上面两种方法都属于破解，HTML5为了解决这个问题，引入了一个全新的API：跨文档通信 API（Cross-document messaging）。")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),t._m(42),t._v(" "),s("p",[t._v("子窗口向父窗口发送消息的写法类似。")]),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),s("p",[t._v("上面代码中，子窗口将父窗口发来的消息，写入自己的LocalStorage。")]),t._v(" "),s("p",[t._v("父窗口发送消息的代码如下。")]),t._v(" "),t._m(56),t._v(" "),s("p",[t._v("加强版的子窗口接收消息的代码如下。")]),t._v(" "),t._m(57),t._v(" "),s("p",[t._v("加强版的父窗口发送消息代码如下。")]),t._v(" "),t._m(58),t._v(" "),t._m(59),t._v(" "),s("p",[t._v("同源政策规定，AJAX请求只能发给同源的网址，否则就报错。")]),t._v(" "),s("p",[t._v("除了架设服务器代理（浏览器请求同源服务器，再由后者请求外部服务），有三种方法规避这个限制。")]),t._v(" "),t._m(60),t._v(" "),t._m(61),t._v(" "),s("p",[t._v("JSONP是服务器与客户端跨源通信的常用方法。最大特点就是简单适用，老式浏览器全部支持，服务器改造非常小。")]),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._v(" "),s("p",[t._v("服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。")]),t._v(" "),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._v(" "),s("p",[t._v("下面是一个例子，浏览器发出的WebSocket请求的头信息（摘自"),s("a",{attrs:{href:"https://en.wikipedia.org/wiki/WebSocket",target:"_blank",rel:"noopener noreferrer"}},[t._v("维基百科"),s("OutboundLink")],1),t._v("）。")]),t._v(" "),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._v(" "),t._m(74),t._v(" "),t._m(75),t._v(" "),s("p",[t._v("（完）")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"浏览器同源政策及其规避方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器同源政策及其规避方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器同源政策及其规避方法")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"一、概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、概述","aria-hidden":"true"}},[this._v("#")]),this._v(" 一、概述")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_1-1-含义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-含义","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1 含义")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("ul",[e("li",[this._v("协议相同")]),this._v(" "),e("li",[this._v("域名相同")]),this._v(" "),e("li",[this._v("端口相同")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("举例来说，"),s("code",[t._v("http://www.example.com/dir/page.html")]),t._v("这个网址，协议是"),s("code",[t._v("http://")]),t._v("，域名是"),s("code",[t._v("www.example.com")]),t._v("，端口是"),s("code",[t._v("80")]),t._v("（默认端口可以省略）。它的同源情况如下。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("ul",[s("li",[s("code",[t._v("http://www.example.com/dir2/other.html")]),t._v("：同源")]),t._v(" "),s("li",[s("code",[t._v("http://example.com/dir/other.html")]),t._v("：不同源（域名不同）")]),t._v(" "),s("li",[s("code",[t._v("http://v2.www.example.com/dir/other.html")]),t._v("：不同源（域名不同）")]),t._v(" "),s("li",[s("code",[t._v("http://www.example.com:81/dir/other.html")]),t._v("：不同源（端口不同）")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_1-2-目的"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-目的","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.2 目的")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_1-3-限制范围"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-限制范围","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.3 限制范围")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("（1） Cookie、LocalStorage 和 IndexDB 无法读取。")]),this._v(" "),e("p",[this._v("（2） DOM 无法获得。")]),this._v(" "),e("p",[this._v("（3） AJAX 请求不能发送。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"二、cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、cookie","aria-hidden":"true"}},[this._v("#")]),this._v(" 二、Cookie")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置"),e("code",[this._v("document.domain")]),this._v("共享 Cookie。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("举例来说，A网页是"),e("code",[this._v("http://w1.example.com/a.html")]),this._v("，B网页是"),e("code",[this._v("http://w2.example.com/b.html")]),this._v("，那么只要设置相同的"),e("code",[this._v("document.domain")]),this._v("，两个网页就可以共享Cookie。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("document.domain = 'example.com';\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('document.cookie = "test1=hello";\n')])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var allCookie = document.cookie;\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("另外，服务器也可以在设置Cookie的时候，指定Cookie的所属域名为一级域名，比如"),e("code",[this._v(".example.com")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Set-Cookie: key=value; domain=.example.com; path=/\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"三、iframe"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、iframe","aria-hidden":"true"}},[this._v("#")]),this._v(" 三、iframe")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果两个网页不同源，就无法拿到对方的DOM。典型的例子是"),e("code",[this._v("iframe")]),this._v("窗口和"),e("code",[this._v("window.open")]),this._v("方法打开的窗口，它们与父窗口无法通信。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("比如，父窗口运行下面的命令，如果"),e("code",[this._v("iframe")]),this._v("窗口不是同源，就会报错。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('document.getElementById("myIFrame").contentWindow.document\n// Uncaught DOMException: Blocked a frame from accessing a cross-origin frame.\n')])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.parent.document.body\n// 报错\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果两个窗口一级域名相同，只是二级域名不同，那么设置上一节介绍的"),e("code",[this._v("document.domain")]),this._v("属性，就可以规避同源政策，拿到DOM。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("ul",[e("li",[this._v("片段识别符（fragment identifier）")]),this._v(" "),e("li",[this._v("window.name")]),this._v(" "),e("li",[this._v("跨文档通信API（Cross-document messaging）")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-1-片段识别符"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-片段识别符","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 片段识别符")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("片段标识符（fragment identifier）指的是，URL的"),e("code",[this._v("#")]),this._v("号后面的部分，比如"),e("code",[this._v("http://example.com/x.html#fragment")]),this._v("的"),e("code",[this._v("#fragment")]),this._v("。如果只是改变片段标识符，页面不会重新刷新。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var src = originURL + '#' + data;\ndocument.getElementById('myIFrame').src = src;\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("子窗口通过监听"),e("code",[this._v("hashchange")]),this._v("事件得到通知。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.onhashchange = checkMessage;\n\nfunction checkMessage() {\n  var message = window.location.hash;\n  // ...\n}\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('parent.location.href= target + "#" + hash;\n')])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-2-window-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-window-name","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 window.name")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("浏览器窗口有"),e("code",[this._v("window.name")]),this._v("属性。这个属性的最大特点是，无论是否同源，只要在同一个窗口里，前一个网页设置了这个属性，后一个网页可以读取它。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("父窗口先打开一个子窗口，载入一个不同源的网页，该网页将信息写入"),e("code",[this._v("window.name")]),this._v("属性。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.name = data;\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("location = 'http://parent.url.com/xxx.html';\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("然后，主窗口就可以读取子窗口的"),e("code",[this._v("window.name")]),this._v("了。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var data = document.getElementById('myFrame').contentWindow.name;\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这种方法的优点是，"),e("code",[this._v("window.name")]),this._v("容量很大，可以放置非常长的字符串；缺点是必须监听子窗口"),e("code",[this._v("window.name")]),this._v("属性的变化，影响网页性能。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-3-window-postmessage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-window-postmessage","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 window.postMessage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这个API为"),e("code",[this._v("window")]),this._v("对象新增了一个"),e("code",[this._v("window.postMessage")]),this._v("方法，允许跨窗口通信，不论这两个窗口是否同源。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("举例来说，父窗口"),e("code",[this._v("http://aaa.com")]),this._v("向子窗口"),e("code",[this._v("http://bbb.com")]),this._v("发消息，调用"),e("code",[this._v("postMessage")]),this._v("方法就可以了。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var popup = window.open('http://bbb.com', 'title');\npopup.postMessage('Hello World!', 'http://bbb.com');\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("postMessage")]),this._v('方法的第一个参数是具体的信息内容，第二个参数是接收消息的窗口的源（origin），即"协议 + 域名 + 端口"。也可以设为'),e("code",[this._v("*")]),this._v("，表示不限制域名，向所有窗口发送。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.opener.postMessage('Nice to see you', 'http://aaa.com');\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("父窗口和子窗口都可以通过"),e("code",[this._v("message")]),this._v("事件，监听对方的消息。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.addEventListener('message', function(e) {\n  console.log(e.data);\n},false);\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("message")]),this._v("事件的事件对象"),e("code",[this._v("event")]),this._v("，提供以下三个属性。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("blockquote",[s("ul",[s("li",[s("code",[t._v("event.source")]),t._v("：发送消息的窗口")]),t._v(" "),s("li",[s("code",[t._v("event.origin")]),t._v(": 消息发向的网址")]),t._v(" "),s("li",[s("code",[t._v("event.data")]),t._v(": 消息内容")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下面的例子是，子窗口通过"),e("code",[this._v("event.source")]),this._v("属性引用父窗口，然后发送消息。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.addEventListener('message', receiveMessage);\nfunction receiveMessage(event) {\n  event.source.postMessage('Nice to see you!', '*');\n}\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("event.origin")]),this._v("属性可以过滤不是发给本窗口的消息。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.addEventListener('message', receiveMessage);\nfunction receiveMessage(event) {\n  if (event.origin !== 'http://aaa.com') return;\n  if (event.data === 'Hello World') {\n      event.source.postMessage('Hello', event.origin);\n  } else {\n    console.log(event.data);\n  }\n}\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-4-localstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-localstorage","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4 LocalStorage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("通过"),e("code",[this._v("window.postMessage")]),this._v("，读写其他窗口的 LocalStorage 也成为了可能。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("下面是一个例子，主窗口写入iframe子窗口的"),e("code",[this._v("localStorage")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.onmessage = function(e) {\n  if (e.origin !== 'http://bbb.com') {\n    return;\n  }\n  var payload = JSON.parse(e.data);\n  localStorage.setItem(payload.key, JSON.stringify(payload.data));\n};\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var win = document.getElementsByTagName('iframe')[0].contentWindow;\nvar obj = { name: 'Jack' };\nwin.postMessage(JSON.stringify({key: 'storage', data: obj}), 'http://bbb.com');\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("window.onmessage = function(e) {\n  if (e.origin !== 'http://bbb.com') return;\n  var payload = JSON.parse(e.data);\n  switch (payload.method) {\n    case 'set':\n      localStorage.setItem(payload.key, JSON.stringify(payload.data));\n      break;\n    case 'get':\n      var parent = window.parent;\n      var data = localStorage.getItem(payload.key);\n      parent.postMessage(data, 'http://aaa.com');\n      break;\n    case 'remove':\n      localStorage.removeItem(payload.key);\n      break;\n  }\n};\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("var win = document.getElementsByTagName('iframe')[0].contentWindow;\nvar obj = { name: 'Jack' };\n// 存入对象\nwin.postMessage(JSON.stringify({key: 'storage', method: 'set', data: obj}), 'http://bbb.com');\n// 读取对象\nwin.postMessage(JSON.stringify({key: 'storage', method: \"get\"}), \"*\");\nwindow.onmessage = function(e) {\n  if (e.origin != 'http://aaa.com') return;\n  // \"Jack\"\n  console.log(JSON.parse(e.data).name);\n};\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"四、ajax"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、ajax","aria-hidden":"true"}},[this._v("#")]),this._v(" 四、AJAX")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("ul",[e("li",[this._v("JSONP")]),this._v(" "),e("li",[this._v("WebSocket")]),this._v(" "),e("li",[this._v("CORS")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_4-1-jsonp"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-jsonp","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.1 JSONP")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("它的基本思想是，网页通过添加一个"),e("code",[this._v("<script>")]),this._v("元素，向服务器请求JSON数据，这种做法不受同源政策限制；服务器收到请求后，将数据放在一个指定名字的回调函数里传回来。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("首先，网页动态插入"),e("code",[this._v("<script>")]),this._v("元素，由它向跨源网址发出请求。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("function addScriptTag(src) {\n  var script = document.createElement('script');\n  script.setAttribute(\"type\",\"text/javascript\");\n  script.src = src;\n  document.body.appendChild(script);\n}\n\nwindow.onload = function () {\n  addScriptTag('http://example.com/ip?callback=foo');\n}\n\nfunction foo(data) {\n  console.log('Your public IP address is: ' + data.ip);\n};\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("上面代码通过动态添加"),e("code",[this._v("<script>")]),this._v("元素，向服务器"),e("code",[this._v("example.com")]),this._v("发出请求。注意，该请求的查询字符串有一个"),e("code",[this._v("callback")]),this._v("参数，用来指定回调函数的名字，这对于JSONP是必需的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('foo({\n  "ip": "8.8.8.8"\n});\n')])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("由于"),e("code",[this._v("<script>")]),this._v("元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了"),e("code",[this._v("foo")]),this._v("函数，该函数就会立即调用。作为参数的JSON数据被视为JavaScript对象，而不是字符串，因此避免了使用"),e("code",[this._v("JSON.parse")]),this._v("的步骤。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_4-2-websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-websocket","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.2 WebSocket")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("WebSocket是一种通信协议，使用"),e("code",[this._v("ws://")]),this._v("（非加密）和"),e("code",[this._v("wss://")]),this._v("（加密）作为协议前缀。该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("GET /chat HTTP/1.1\nHost: server.example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\nOrigin: http://example.com\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("上面代码中，有一个字段是"),e("code",[this._v("Origin")]),this._v("，表示该请求的请求源（origin），即发自哪个域名。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("正是因为有了"),e("code",[this._v("Origin")]),this._v("这个字段，所以WebSocket才没有实行同源政策。因为服务器可以根据这个字段，判断是否许可本次通信。如果该域名在白名单内，服务器就会做出如下回应。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=\nSec-WebSocket-Protocol: chat\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_4-3-cors"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-cors","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.3 CORS")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("CORS是跨源资源分享（Cross-Origin Resource Sharing）的缩写。它是W3C标准，是跨源AJAX请求的根本解决方法。相比JSONP只能发"),e("code",[this._v("GET")]),this._v("请求，CORS允许任何类型的请求。")])}],!1,null,null,null);e.default=i.exports}}]);